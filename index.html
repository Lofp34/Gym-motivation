<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, viewport-fit=cover, initial-scale=1.0" />
  <title>Mon Coach Virtuel - Programme & Journal</title>
  <!-- Police Google -->
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
  />
  <style>
    /*************************************************
     * VARIABLES DE COULEUR ET PARAMÈTRES
     *************************************************/
    :root {
      --primary-color: #5865F2;         /* Discord Blurple */
      --secondary-color: #43B581;       /* Vert vibrant */
      --accent-color: #FEE75C;          /* Jaune solaire */
      --background-color: #F4F6FA;      /* Gris clair */
      --card-background: #FFFFFF;       /* Blanc */
      --text-color-primary: #36393F;    /* Gris foncé */
      --text-color-secondary: #72767D;  /* Gris moyen */
      --border-radius: 12px;
      --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--background-color);
      color: var(--text-color-primary);
      min-height: 100vh;
      -webkit-overflow-scrolling: touch;
    }

    /*************************************************
     * HEADER AVEC NAVIGATION (PROGRAMME / JOURNAL)
     *************************************************/
    header {
      background: linear-gradient(
        135deg,
        var(--primary-color) 0%,
        var(--secondary-color) 100%
      );
      color: white;
      text-align: center;
      width: 100%;
      box-shadow: var(--box-shadow);
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      box-sizing: border-box;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    header h1 {
      margin: 0;
      font-weight: 600;
      letter-spacing: -0.5px;
      font-size: 1.2rem;
    }

    .nav-buttons {
      display: flex;
      gap: 8px;
    }

    .nav-button {
      background-color: transparent;
      color: #fff;
      border: 1px solid white;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .nav-button.active {
      background-color: white;
      color: var(--primary-color);
    }

    /* Minuteur de repos dans le header */
    .rest-timer-header {
      font-size: 1rem;
      font-weight: 600;
      color: var(--accent-color);
    }

    /*************************************************
     * CONTENUS DE L'APPLICATION
     *************************************************/
    .container {
      max-width: 600px;
      width: 90%;
      margin: 0 auto;
      padding: 20px 0;
      box-sizing: border-box;
    }

    /* Pages cachées / affichées dynamiquement */
    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    /*************************************************
     * PAGE PROGRAMME (SIMILAIRE AU CODE EXISTANT)
     *************************************************/
    .session-card {
      background-color: var(--card-background);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      margin-bottom: 20px;
      transition: transform 0.2s ease-in-out;
    }
    .session-card:hover {
      transform: scale(1.02);
    }

    .session-card h2 {
      color: var(--primary-color);
      margin-top: 0;
      margin-bottom: 15px;
      font-weight: 500;
    }

    .exercise-group {
      margin-bottom: 15px;
    }

    .exercise-group h3 {
      color: var(--text-color-secondary);
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1rem;
      font-weight: 400;
    }

    .exercise {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .exercise:last-child {
      border-bottom: none;
    }

    .exercise-name {
      font-weight: 500;
    }

    .set-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .set-button {
      background-color: transparent;
      border: 2px solid var(--secondary-color);
      color: var(--secondary-color);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0.8rem;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
      position: relative;
    }
    .set-button.completed {
      background-color: var(--secondary-color);
      color: white;
      border-color: var(--secondary-color);
    }
    .set-button:focus {
      outline: none;
    }

    .session-progress {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      margin-top: 5px;
      font-size: 0.8rem;
      color: var(--text-color-secondary);
    }
    .session-progress span {
      margin-left: 5px;
    }

    /* Animations */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .set-button.completed {
      animation: pulse 0.5s ease-in-out;
    }

    /*************************************************
     * MESSAGE DE FEEDBACK GÉNÉRAL
     *************************************************/
    .feedback-message {
      text-align: center;
      margin-top: 20px;
      font-style: italic;
      color: var(--text-color-secondary);
      min-height: 20px;
    }

    /*************************************************
     * MODAL POUR SAISIE RÉPS & POIDS
     *************************************************/
    .modal-overlay {
      position: fixed;
      top: 0; 
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal {
      background: white;
      border-radius: var(--border-radius);
      padding: 20px;
      width: 80%;
      max-width: 300px;
      box-shadow: var(--box-shadow);
    }
    .modal h3 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }
    .modal label {
      display: block;
      margin-bottom: 5px;
    }
    .modal select {
      width: 100%;
      padding: 5px;
      margin-bottom: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    .modal-buttons {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    .modal-button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
    }
    .cancel-button {
      background-color: #E1E1E1;
      color: #333;
    }
    .save-button {
      background-color: var(--primary-color);
      color: #fff;
    }

    /*************************************************
     * PAGE JOURNAL : CALENDRIER & STATISTIQUES
     *************************************************/
    .calendar-container {
      background-color: var(--card-background);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .calendar-header h2 {
      margin: 0;
      color: var(--primary-color);
      font-weight: 500;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }
    .day-cell {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      text-align: center;
      padding: 10px 5px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .day-cell:hover {
      background-color: #f2f2f2;
    }
    .day-cell.workout {
      background-color: var(--secondary-color);
      color: #fff;
      border-color: var(--secondary-color);
    }
    .day-number {
      font-weight: 600;
    }

    /* Carte d'entraînement du jour sélectionné */
    .journal-detail {
      margin-top: 20px;
      padding: 15px;
      background: #fff;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }
    .journal-detail h3 {
      margin-top: 0;
      color: var(--primary-color);
    }
    .entry-exercise {
      border-bottom: 1px solid #eee;
      padding: 8px 0;
      font-size: 0.9rem;
    }

    /* Statistiques mensuelles */
    .monthly-stats {
      margin-top: 20px;
      background: #fff;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 15px;
    }
    .stats-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    .stats-label {
      color: var(--text-color-secondary);
      font-size: 0.9rem;
    }
    .stats-value {
      font-weight: 600;
    }
    .progress-bar-container {
      background-color: #eee;
      border-radius: 10px;
      height: 10px;
      margin-top: 10px;
      overflow: hidden;
    }
    .progress-bar {
      background-color: var(--accent-color);
      height: 100%;
      width: 0%;
      border-radius: 10px;
      transition: width 0.3s ease-in-out;
    }

    /* Responsivité */
    @media (max-width: 400px) {
      header {
        flex-direction: column;
        gap: 10px;
      }
      .nav-button {
        font-size: 0.8rem;
        padding: 4px 8px;
      }
      .rest-timer-header {
        margin-top: 4px;
      }
      .session-card {
        padding: 15px;
      }
      .calendar-grid {
        gap: 2px;
      }
      .day-cell {
        padding: 6px 3px;
      }
      .modal {
        width: 90%;
      }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <div class="header-left">
      <h1>Mon Coach Virtuel</h1>
    </div>
    <div class="header-right">
      <!-- Minuteur de repos toujours visible -->
      <div class="rest-timer-header">
        Repos: <span id="timer">--</span> sec
      </div>
      <!-- Boutons de navigation : Programme / Journal -->
      <div class="nav-buttons">
        <button class="nav-button active" data-target="programmePage">Programme</button>
        <button class="nav-button" data-target="journalPage">Journal</button>
      </div>
    </div>
  </header>

  <div class="container">

    <!-- PAGE PROGRAMME -->
    <div id="programmePage" class="page active">
      <!-- Ici le code du programme (similaire à la version précédente) -->
      <!-- Jour 1 -->
      <div class="session-card" id="jour1">
        <h2>Jour 1: Poitrine & Triceps</h2>
        <div class="exercise-group">
          <h3>Poitrine</h3>
          <div class="exercise">
            <span class="exercise-name">Développé couché</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="developpe-couche" data-set="1">1</button>
              <button class="set-button" data-exercise="developpe-couche" data-set="2">2</button>
              <button class="set-button" data-exercise="developpe-couche" data-set="3">3</button>
              <button class="set-button" data-exercise="developpe-couche" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Écartés avec haltères</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="ecartes-halteres" data-set="1">1</button>
              <button class="set-button" data-exercise="ecartes-halteres" data-set="2">2</button>
              <button class="set-button" data-exercise="ecartes-halteres" data-set="3">3</button>
              <button class="set-button" data-exercise="ecartes-halteres" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Pompes</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="pompes" data-set="1">1</button>
              <button class="set-button" data-exercise="pompes" data-set="2">2</button>
              <button class="set-button" data-exercise="pompes" data-set="3">3</button>
              <button class="set-button" data-exercise="pompes" data-set="4">4</button>
            </div>
          </div>
        </div>
        <div class="exercise-group">
          <h3>Triceps</h3>
          <div class="exercise">
            <span class="exercise-name">Dips sur banc</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="dips-banc" data-set="1">1</button>
              <button class="set-button" data-exercise="dips-banc" data-set="2">2</button>
              <button class="set-button" data-exercise="dips-banc" data-set="3">3</button>
              <button class="set-button" data-exercise="dips-banc" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Extension triceps à la poulie</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="extension-triceps" data-set="1">1</button>
              <button class="set-button" data-exercise="extension-triceps" data-set="2">2</button>
              <button class="set-button" data-exercise="extension-triceps" data-set="3">3</button>
              <button class="set-button" data-exercise="extension-triceps" data-set="4">4</button>
            </div>
          </div>
        </div>
        <div class="session-progress">
          Progression: <span id="progress-jour1">0%</span>
        </div>
      </div>

      <!-- Jour 2 -->
      <div class="session-card" id="jour2">
        <h2>Jour 2: Dos & Biceps</h2>
        <div class="exercise-group">
          <h3>Dos</h3>
          <div class="exercise">
            <span class="exercise-name">Tirage vertical</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="tirage-vertical" data-set="1">1</button>
              <button class="set-button" data-exercise="tirage-vertical" data-set="2">2</button>
              <button class="set-button" data-exercise="tirage-vertical" data-set="3">3</button>
              <button class="set-button" data-exercise="tirage-vertical" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Rowing barre / haltères</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="rowing" data-set="1">1</button>
              <button class="set-button" data-exercise="rowing" data-set="2">2</button>
              <button class="set-button" data-exercise="rowing" data-set="3">3</button>
              <button class="set-button" data-exercise="rowing" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Tirage poulie basse</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="tirage-poulie-basse" data-set="1">1</button>
              <button class="set-button" data-exercise="tirage-poulie-basse" data-set="2">2</button>
              <button class="set-button" data-exercise="tirage-poulie-basse" data-set="3">3</button>
              <button class="set-button" data-exercise="tirage-poulie-basse" data-set="4">4</button>
            </div>
          </div>
        </div>
        <div class="exercise-group">
          <h3>Biceps</h3>
          <div class="exercise">
            <span class="exercise-name">Curl biceps</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="curl-biceps" data-set="1">1</button>
              <button class="set-button" data-exercise="curl-biceps" data-set="2">2</button>
              <button class="set-button" data-exercise="curl-biceps" data-set="3">3</button>
              <button class="set-button" data-exercise="curl-biceps" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Curl marteau</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="curl-marteau" data-set="1">1</button>
              <button class="set-button" data-exercise="curl-marteau" data-set="2">2</button>
              <button class="set-button" data-exercise="curl-marteau" data-set="3">3</button>
              <button class="set-button" data-exercise="curl-marteau" data-set="4">4</button>
            </div>
          </div>
        </div>
        <div class="session-progress">
          Progression: <span id="progress-jour2">0%</span>
        </div>
      </div>

      <!-- Jour 3 -->
      <div class="session-card" id="jour3">
        <h2>Jour 3: Jambes & Fessiers</h2>
        <div class="exercise-group">
          <h3>Jambes & Fessiers</h3>
          <div class="exercise">
            <span class="exercise-name">Squats</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="squats" data-set="1">1</button>
              <button class="set-button" data-exercise="squats" data-set="2">2</button>
              <button class="set-button" data-exercise="squats" data-set="3">3</button>
              <button class="set-button" data-exercise="squats" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Fentes marchées</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="fentes-marchees" data-set="1">1</button>
              <button class="set-button" data-exercise="fentes-marchees" data-set="2">2</button>
              <button class="set-button" data-exercise="fentes-marchees" data-set="3">3</button>
              <button class="set-button" data-exercise="fentes-marchees" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Presse à cuisses</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="presse-cuisses" data-set="1">1</button>
              <button class="set-button" data-exercise="presse-cuisses" data-set="2">2</button>
              <button class="set-button" data-exercise="presse-cuisses" data-set="3">3</button>
              <button class="set-button" data-exercise="presse-cuisses" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Leg Curl</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="leg-curl" data-set="1">1</button>
              <button class="set-button" data-exercise="leg-curl" data-set="2">2</button>
              <button class="set-button" data-exercise="leg-curl" data-set="3">3</button>
              <button class="set-button" data-exercise="leg-curl" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Hip Thrust / Ponts fessiers</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="hip-thrust" data-set="1">1</button>
              <button class="set-button" data-exercise="hip-thrust" data-set="2">2</button>
              <button class="set-button" data-exercise="hip-thrust" data-set="3">3</button>
              <button class="set-button" data-exercise="hip-thrust" data-set="4">4</button>
            </div>
          </div>
        </div>
        <div class="session-progress">
          Progression: <span id="progress-jour3">0%</span>
        </div>
      </div>

      <!-- Jour 4 -->
      <div class="session-card" id="jour4">
        <h2>Jour 4: Épaules & Abdos</h2>
        <div class="exercise-group">
          <h3>Épaules</h3>
          <div class="exercise">
            <span class="exercise-name">Développé militaire</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="developpe-militaire" data-set="1">1</button>
              <button class="set-button" data-exercise="developpe-militaire" data-set="2">2</button>
              <button class="set-button" data-exercise="developpe-militaire" data-set="3">3</button>
              <button class="set-button" data-exercise="developpe-militaire" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Élévations latérales</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="elevations-laterales" data-set="1">1</button>
              <button class="set-button" data-exercise="elevations-laterales" data-set="2">2</button>
              <button class="set-button" data-exercise="elevations-laterales" data-set="3">3</button>
              <button class="set-button" data-exercise="elevations-laterales" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Élévations frontales</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="elevations-frontales" data-set="1">1</button>
              <button class="set-button" data-exercise="elevations-frontales" data-set="2">2</button>
              <button class="set-button" data-exercise="elevations-frontales" data-set="3">3</button>
              <button class="set-button" data-exercise="elevations-frontales" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Oiseau inversé</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="oiseau-inverse" data-set="1">1</button>
              <button class="set-button" data-exercise="oiseau-inverse" data-set="2">2</button>
              <button class="set-button" data-exercise="oiseau-inverse" data-set="3">3</button>
              <button class="set-button" data-exercise="oiseau-inverse" data-set="4">4</button>
            </div>
          </div>
        </div>
        <div class="exercise-group">
          <h3>Abdos</h3>
          <div class="exercise">
            <span class="exercise-name">Planche</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="planche" data-set="1">1</button>
              <button class="set-button" data-exercise="planche" data-set="2">2</button>
              <button class="set-button" data-exercise="planche" data-set="3">3</button>
              <button class="set-button" data-exercise="planche" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Crunchs / Relevés de buste</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="crunchs" data-set="1">1</button>
              <button class="set-button" data-exercise="crunchs" data-set="2">2</button>
              <button class="set-button" data-exercise="crunchs" data-set="3">3</button>
              <button class="set-button" data-exercise="crunchs" data-set="4">4</button>
            </div>
          </div>
        </div>
        <div class="session-progress">
          Progression: <span id="progress-jour4">0%</span>
        </div>
      </div>

      <!-- Jour 5 -->
      <div class="session-card" id="jour5">
        <h2>Jour 5: Session « Rappel » ou Circuit Full Body</h2>
        <p>Choisissez votre option pour cette session.</p>
        <h3>Option Circuit Full Body</h3>
        <div class="exercise-group">
          <div class="exercise">
            <span class="exercise-name">Burpees / Mountain Climbers</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="burpees" data-set="1">1</button>
              <button class="set-button" data-exercise="burpees" data-set="2">2</button>
              <button class="set-button" data-exercise="burpees" data-set="3">3</button>
              <button class="set-button" data-exercise="burpees" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Kettlebell Swings</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="kettlebell-swings" data-set="1">1</button>
              <button class="set-button" data-exercise="kettlebell-swings" data-set="2">2</button>
              <button class="set-button" data-exercise="kettlebell-swings" data-set="3">3</button>
              <button class="set-button" data-exercise="kettlebell-swings" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Pompes / Dips sur banc</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="pompes-circuit" data-set="1">1</button>
              <button class="set-button" data-exercise="pompes-circuit" data-set="2">2</button>
              <button class="set-button" data-exercise="pompes-circuit" data-set="3">3</button>
              <button class="set-button" data-exercise="pompes-circuit" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Squats sautés</span>
            <div class="set-controls">
              <button class="set-button" data-exercise="squats-sautes" data-set="1">1</button>
              <button class="set-button" data-exercise="squats-sautes" data-set="2">2</button>
              <button class="set-button" data-exercise="squats-sautes" data-set="3">3</button>
              <button class="set-button" data-exercise="squats-sautes" data-set="4">4</button>
            </div>
          </div>
          <div class="exercise">
            <span class="exercise-name">Planche latérale</span>
            <div class="set-controls">
              <!-- Par exemple G1/D1, G2/D2, etc. -->
              <button class="set-button" data-exercise="planche-laterale-gauche" data-set="1">G1</button>
              <button class="set-button" data-exercise="planche-laterale-droite" data-set="1">D1</button>
              <button class="set-button" data-exercise="planche-laterale-gauche" data-set="2">G2</button>
              <button class="set-button" data-exercise="planche-laterale-droite" data-set="2">D2</button>
            </div>
          </div>
        </div>
        <div class="session-progress">
          Progression: <span id="progress-jour5">0%</span>
        </div>
      </div>

      <div class="feedback-message" id="feedback"></div>
    </div>

    <!-- PAGE JOURNAL -->
    <div id="journalPage" class="page">
      <div class="calendar-container">
        <div class="calendar-header">
          <h2 id="calendarMonthYear">Mon Calendrier</h2>
        </div>
        <div class="calendar-grid" id="calendarGrid">
          <!-- Cases dynamiques (jours du mois) -->
        </div>
      </div>

      <div class="journal-detail" id="journalDetail" style="display: none;">
        <h3 id="detailTitle"></h3>
        <div id="detailContent"></div>
      </div>

      <!-- Statistiques Mensuelles -->
      <div class="monthly-stats" id="monthlyStats" style="display: none;">
        <h3>Statistiques du mois</h3>
        <div class="stats-row">
          <div class="stats-label">Total de répétitions :</div>
          <div class="stats-value" id="totalReps">0</div>
        </div>
        <div class="stats-row">
          <div class="stats-label">Poids total soulevé :</div>
          <div class="stats-value" id="totalWeight">0 kg</div>
        </div>
        <div class="stats-row">
          <div class="stats-label">Nombre de séances :</div>
          <div class="stats-value" id="totalSessions">0</div>
        </div>
        <div class="stats-row">
          <div class="stats-label">Objectif mensuel :</div>
          <div class="stats-value">5 séances / semaine</div>
        </div>
        <!-- Barre de progression -->
        <div class="progress-bar-container">
          <div class="progress-bar" id="monthlyProgressBar"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="modal">
      <h3>Renseignez votre série</h3>
      <label for="repSelect">Nombre de répétitions</label>
      <select id="repSelect">
        <!-- De 0 à 20 répétitions -->
      </select>

      <label for="weightSelect">Poids utilisé</label>
      <select id="weightSelect">
        <!-- PDC (poids du corps) + 5 kg à 100 kg par tranche de 5 -->
      </select>

      <div class="modal-buttons">
        <button class="modal-button cancel-button" id="cancelModal">Annuler</button>
        <button class="modal-button save-button" id="saveModal">Enregistrer</button>
      </div>
    </div>
  </div>

  <script>
    /*******************************************************
     * 1. GESTION DES SPINNERS POUR REPS ET POIDS
     *******************************************************/
    const repSelect = document.getElementById('repSelect');
    const weightSelect = document.getElementById('weightSelect');
    
    // Remplir le sélecteur des répétitions (0 à 20)
    for(let i=0; i<=20; i++){
      const option = document.createElement('option');
      option.value = i;
      option.text = i;
      repSelect.appendChild(option);
    }

    // Remplir le sélecteur de poids
    const pdcOption = document.createElement('option');
    pdcOption.value = 'PDC';
    pdcOption.text = 'PDC (Poids du corps)';
    weightSelect.appendChild(pdcOption);

    for(let w=5; w<=100; w+=5){
      const option = document.createElement('option');
      option.value = w;
      option.text = w + ' kg';
      weightSelect.appendChild(option);
    }

    /*******************************************************
     * 2. GESTION DU MODAL
     *******************************************************/
    const modalOverlay = document.getElementById('modalOverlay');
    const modal = document.getElementById('modal');
    const cancelModal = document.getElementById('cancelModal');
    const saveModal = document.getElementById('saveModal');
    let currentButton = null; // Bouton sur lequel l’utilisateur a cliqué

    function openModal(button) {
      currentButton = button;
      // Charger d’éventuelles valeurs précédemment sauvegardées
      const exerciseKey = button.getAttribute('data-exercise');
      const setNumber = button.getAttribute('data-set');
      const dateKey = getCurrentDateKey();
      const savedData = getLocalStorageData(dateKey, exerciseKey, setNumber);

      if(savedData){
        repSelect.value = savedData.reps || 0;
        weightSelect.value = savedData.weight || 'PDC';
      } else {
        repSelect.value = 0;
        weightSelect.value = 'PDC';
      }

      modalOverlay.style.display = 'flex';
    }

    function closeModal() {
      modalOverlay.style.display = 'none';
      currentButton = null;
    }

    cancelModal.addEventListener('click', closeModal);

    saveModal.addEventListener('click', () => {
      if(!currentButton) return;
      const exerciseKey = currentButton.getAttribute('data-exercise');
      const setNumber = currentButton.getAttribute('data-set');
      const dateKey = getCurrentDateKey();

      const reps = repSelect.value;
      const weight = weightSelect.value;

      saveLocalStorageData(dateKey, exerciseKey, setNumber, reps, weight);

      // Marquer le bouton comme "completed"
      currentButton.classList.add('completed');
      // Mettre à jour la progression de la session
      const sessionId = currentButton.closest('.session-card').id;
      updateSessionProgress(sessionId);
      showFeedback("Série enregistrée !");
      
      // Redémarrer le minuteur
      startRestTimer();

      closeModal();
      // Mise à jour du calendrier (journal)
      if(document.getElementById('journalPage').classList.contains('active')){
        generateCalendar(currentMonth, currentYear);
      }
    });

    /*******************************************************
     * 3. GESTION DU LOCALSTORAGE
     *******************************************************/
    // on stocke sous forme :
    // data = {
    //   [dateKey]: {
    //     [exerciseName]: {
    //       [setNumber]: { reps, weight }
    //     },
    //     ...
    //   },
    //   ...
    // }
    function getLocalStorage() {
      const data = localStorage.getItem('monCoachVirtuelData');
      return data ? JSON.parse(data) : {};
    }
    function setLocalStorage(data) {
      localStorage.setItem('monCoachVirtuelData', JSON.stringify(data));
    }

    function saveLocalStorageData(dateKey, exerciseName, setNumber, reps, weight) {
      const data = getLocalStorage();
      if(!data[dateKey]) data[dateKey] = {};
      if(!data[dateKey][exerciseName]) data[dateKey][exerciseName] = {};
      data[dateKey][exerciseName][setNumber] = { reps, weight };
      setLocalStorage(data);
    }

    function getLocalStorageData(dateKey, exerciseName, setNumber) {
      const data = getLocalStorage();
      if(!data[dateKey]) return null;
      if(!data[dateKey][exerciseName]) return null;
      return data[dateKey][exerciseName][setNumber] || null;
    }

    /*******************************************************
     * 4. MINUTEUR DE REPOS
     *******************************************************/
    const timerSpan = document.getElementById('timer');
    let restInterval;
    let restDuration = 60; // 60 secondes par défaut

    function startRestTimer(){
      if(restInterval){
        clearInterval(restInterval);
        restInterval = null;
      }
      let timeLeft = restDuration;
      timerSpan.textContent = timeLeft;

      restInterval = setInterval(() => {
        timeLeft--;
        timerSpan.textContent = timeLeft;
        if(timeLeft <= 0){
          clearInterval(restInterval);
          restInterval = null;
          timerSpan.textContent = 'Terminé';
          showFeedback("Fin du repos, c'est reparti !");
        }
      }, 1000);
    }

    /*******************************************************
     * 5. PROGRESSION DANS CHAQUE SESSION
     *******************************************************/
    function updateSessionProgress(sessionId) {
      const sessionCard = document.getElementById(sessionId);
      const totalSets = sessionCard.querySelectorAll('.set-button').length;
      const completedSets = sessionCard.querySelectorAll('.set-button.completed').length;
      const progressPercent = Math.round((completedSets / totalSets) * 100);
      document.getElementById(`progress-${sessionId}`).textContent = `${progressPercent}%`;
    }

    /*******************************************************
     * 6. FEEDBACK
     *******************************************************/
    const feedbackDiv = document.getElementById('feedback');
    function showFeedback(message) {
      feedbackDiv.textContent = message;
      setTimeout(() => {
        if(feedbackDiv.textContent === message) {
          feedbackDiv.textContent = "";
        }
      }, 2000);
    }

    /*******************************************************
     * 7. INITIALISATION DES BOUTONS DE SÉRIE
     *******************************************************/
    const setButtons = document.querySelectorAll('.set-button');
    setButtons.forEach(button => {
      // Au clic, on ouvre le modal (puis on relancera le timer quand on enregistre)
      button.addEventListener('click', function(){
        openModal(this);
      });
    });

    // Au chargement, marquer en "completed" si déjà sauvegardé
    window.addEventListener('DOMContentLoaded', () => {
      markCompletedSets();
      // Mise à jour de la progression dans chaque carte
      document.querySelectorAll('.session-card').forEach(card => {
        updateSessionProgress(card.id);
      });
    });

    function markCompletedSets(){
      // On parcourt tous les boutons et on regarde si localStorage a des infos
      const dateKey = getCurrentDateKey(); // date du jour
      const data = getLocalStorage();
      // Si on veut marquer les sets passés d'autres jours, c'est plus complexe,
      // mais ici on marque ceux du jour ou on pourrait tous les marquer (tous jours).
      // Pour marquer tous les jours, on parcourt toutes les dates. On va opter pour
      // un marquage global (tous jours) : si un set a été fait un jour quelconque,
      // on "pourrait" le marquer. Cependant, souvent on ne veut marquer que pour la journée.
      // On reste simple : on marque si la date du jour a les sets.
      // (On peut adapter selon les besoins.)

      setButtons.forEach(btn => {
        const exerciseName = btn.getAttribute('data-exercise');
        const setNumber = btn.getAttribute('data-set');
        // On vérifie toutes les dates ? on part de l'hypothèse : 
        // "Complété" = déjà fait un jour = stats globales 
        // Mais on va faire un check "jour en cours" pour rester cohérent.
        if(data[dateKey] && data[dateKey][exerciseName] && data[dateKey][exerciseName][setNumber]){
          btn.classList.add('completed');
        }
      });
    }

    // Date key (pour journal) : "YYYY-MM-DD"
    function getCurrentDateKey(){
      const d = new Date();
      const year = d.getFullYear();
      const month = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${year}-${month}-${day}`;
    }

    /*******************************************************
     * 8. SWITCH ENTRE LES PAGES
     *******************************************************/
    const navButtons = document.querySelectorAll('.nav-button');
    const pages = document.querySelectorAll('.page');
    navButtons.forEach(btn => {
      btn.addEventListener('click', function(){
        navButtons.forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        const targetId = this.getAttribute('data-target');
        pages.forEach(p => p.classList.remove('active'));
        document.getElementById(targetId).classList.add('active');

        // Si on vient sur la page "journalPage", on génère le calendrier
        if(targetId === 'journalPage'){
          generateCalendar(currentMonth, currentYear);
        }
      });
    });

    /*******************************************************
     * 9. JOURNAL : CALENDRIER + DÉTAIL DE LA JOURNÉE
     *******************************************************/
    const calendarGrid = document.getElementById('calendarGrid');
    const journalDetail = document.getElementById('journalDetail');
    const detailTitle = document.getElementById('detailTitle');
    const detailContent = document.getElementById('detailContent');
    const monthlyStats = document.getElementById('monthlyStats');
    const totalRepsEl = document.getElementById('totalReps');
    const totalWeightEl = document.getElementById('totalWeight');
    const totalSessionsEl = document.getElementById('totalSessions');
    const monthlyProgressBar = document.getElementById('monthlyProgressBar');
    const calendarMonthYear = document.getElementById('calendarMonthYear');

    // On va afficher le mois en cours (et l'année)
    const now = new Date();
    let currentMonth = now.getMonth();  // 0-11
    let currentYear = now.getFullYear();

    function generateCalendar(month, year){
      calendarGrid.innerHTML = '';
      journalDetail.style.display = 'none';
      monthlyStats.style.display = 'none';

      // Titre : ex. "Juillet 2023"
      const monthNames = [
        'Janvier','Février','Mars','Avril','Mai','Juin',
        'Juillet','Août','Septembre','Octobre','Novembre','Décembre'
      ];
      calendarMonthYear.textContent = `${monthNames[month]} ${year}`;

      // 1) Premier jour du mois
      const firstDay = new Date(year, month, 1).getDay(); 
      // En JS, getDay() renvoie 0 (Dim) à 6 (Sam).
      // On veut un calendrier Lun->Dim ou Dim->Sam ? 
      // On va supposer un Dim->Sam (par défaut en JS).
      // 2) Nombre de jours dans le mois
      const daysInMonth = new Date(year, month+1, 0).getDate();

      // 3) On crée des cases "vides" avant le 1er jour, si besoin
      //    (pour aligner le 1er jour dans le calendrier).
      //    Si firstDay=0 (Dimanche), on met 0 "blancs", si firstDay=1 (Lundi), 1 ...
      //    A adapter selon la convention de départ (ici Dimanche = 0).
      for(let i=0; i<firstDay; i++){
        const emptyCell = document.createElement('div');
        emptyCell.className = 'day-cell';
        calendarGrid.appendChild(emptyCell);
      }

      // 4) On crée les jours réels
      const data = getLocalStorage();
      for(let day=1; day <= daysInMonth; day++){
        const cell = document.createElement('div');
        cell.className = 'day-cell';

        const dayNum = document.createElement('div');
        dayNum.className = 'day-number';
        dayNum.textContent = day;
        cell.appendChild(dayNum);

        // On formate la date en YYYY-MM-DD
        const dateKey = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;

        // Vérif si on a des datas pour ce jour
        if(data[dateKey]){
          cell.classList.add('workout');
        }

        // Au clic, on affiche le détail
        cell.addEventListener('click', () => {
          showDayDetail(dateKey);
        });

        calendarGrid.appendChild(cell);
      }

      // 5) Calcul et affichage des stats mensuelles
      calculateMonthlyStats(month, year);
    }

    function showDayDetail(dateKey){
      journalDetail.style.display = 'block';
      detailTitle.textContent = `Détail du ${dateKey}`;
      detailContent.innerHTML = '';

      const data = getLocalStorage();
      const dayData = data[dateKey];
      if(!dayData){
        detailContent.innerHTML = '<p>Aucun entraînement ce jour-là.</p>';
        return;
      }

      // dayData = { exerciseName: { setNumber: {reps, weight}, ... }, ... }
      // On va lister exercice par exercice
      for(const exName in dayData){
        const sets = dayData[exName];
        for(const setNum in sets){
          const info = sets[setNum];
          const divEx = document.createElement('div');
          divEx.className = 'entry-exercise';
          divEx.textContent = `${exName} - Série ${setNum} : ${info.reps} rép., ${info.weight}`;
          detailContent.appendChild(divEx);
        }
      }
    }

    function calculateMonthlyStats(month, year){
      monthlyStats.style.display = 'block';

      // On parcourt toutes les dates du mois, on additionne total reps, total weight, et nb de séances
      let repsSum = 0;
      let weightSum = 0;
      let sessionCount = 0;

      const data = getLocalStorage();
      const daysInMonth = new Date(year, month+1, 0).getDate();

      for(let d=1; d<=daysInMonth; d++){
        const dateKey = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        if(data[dateKey]){
          // On compte 1 séance si on a au moins un exercice pour ce jour
          sessionCount++;
          // On accumule le total reps & total weight
          for(const exName in data[dateKey]){
            for(const setNum in data[dateKey][exName]){
              const info = data[dateKey][exName][setNum];
              const reps = parseInt(info.reps, 10) || 0;
              let w = 0;
              if(info.weight === 'PDC') {
                // On ne sait pas le poids exact, on peut considérer PDC = 0 ou un placeholder
                w = 0;
              } else {
                w = parseInt(info.weight, 10) || 0;
              }
              repsSum += reps;
              // Poids total soulevé = reps * w (simpliste, 
              // on part du principe qu'on soulève ce poids à chaque répétition)
              weightSum += (reps * w);
            }
          }
        }
      }

      totalRepsEl.textContent = repsSum;
      totalWeightEl.textContent = weightSum + ' kg';
      totalSessionsEl.textContent = sessionCount;

      // Objectif : 5 séances par semaine, ~4 semaines dans un mois => 20 séances 
      // On fait un prorata selon le nombre de jours ?
      // ex : 5 séances/semaine => ~ (5/7) séances par jour => 5/7 * nb jours
      const daysFactor = 5/7;
      const target = Math.round(daysInMonth * daysFactor);

      // Calcul de la progression
      let progress = 0;
      if(target > 0) progress = Math.round((sessionCount / target) * 100);
      if(progress > 100) progress = 100;

      monthlyProgressBar.style.width = progress + '%';
    }

  </script>
</body>
</html>
