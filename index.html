<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>MVP Sport - Tiny Habits & Behavior Design</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- STYLES INLINE POUR UN FICHIER UNIQUE -->
  <style>
    /* RESET BASIQUE */
    * {
      margin: 0; 
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    }

    /* Mode clair (par défaut) */
    body {
      background-color: #f7f7f7;
      color: #333;
      line-height: 1.4;
      font-size: 16px;
      transition: background 0.3s, color 0.3s;
    }

    /* Mode sombre */
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }

    header,
    nav,
    section,
    footer {
      width: 100%;
      max-width: 400px; /* Pour s'adapter à l'iPhone 12 (~390px) */
      margin: auto;
      padding: 1em;
    }

    /* NAVIGATION SIMPLE */
    .nav-bar {
      display: flex;
      justify-content: space-around;
      margin-bottom: 1em;
      align-items: center;
    }
    .nav-bar button {
      background: none;
      border: none;
      font-size: 1rem;
      color: inherit;
      padding: 0.5em 1em;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    .nav-bar button:hover {
      opacity: 0.7;
    }
    .nav-bar button.active {
      font-weight: bold;
      color: #3B82F6; /* Couleur d'accent en mode clair */
    }
    body.dark-mode .nav-bar button.active {
      color: #7C3AED; /* Couleur d'accent si on veut la changer en mode sombre, par ex. */
    }

    /* Bouton Dark Mode */
    #toggleDarkModeBtn {
      font-size: 0.9rem;
      border: 1px solid;
      border-radius: 4px;
      padding: 0.3em 0.6em;
    }

    /* TITRES ET SECTIONS */
    h1, h2 {
      margin-bottom: 0.5em;
    }
    h1 {
      font-size: 1.6rem;
      color: #3B82F6; /* Couleur d'accent principale */
      transition: color 0.3s;
    }
    body.dark-mode h1 {
      color: #7C3AED; /* Couleur d'accent en mode sombre */
    }
    h2 {
      font-size: 1.2rem;
      margin-top: 0.5em;
    }
    p {
      margin-bottom: 0.5em;
    }

    /* BOUTONS CTA */
    .btn {
      display: inline-block;
      background: linear-gradient(45deg, #3B82F6, #7C3AED);
      color: #fff;
      text-align: center;
      padding: 0.8em 1.2em;
      border-radius: 8px;
      text-decoration: none;
      border: none;
      cursor: pointer;
      margin: 1em 0;
      font-weight: 500;
      transition: transform 0.2s, opacity 0.2s;
    }
    .btn:hover {
      transform: scale(0.98);
    }

    /* En mode sombre, on change éventuellement le gradient si on veut */
    body.dark-mode .btn {
      background: linear-gradient(45deg, #6d28d9, #3b82f6);
    }

    /* STRUCTURE DES SECTIONS (HIDDEN/ACTIVE) */
    section {
      display: none; /* Par défaut on masque tout, on affiche seulement la section active via JS */
    }
    section.active {
      display: block;
      animation: fadeIn 0.4s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* CARTES DE PROGRAMME */
    .program-card {
      background: #fff;
      border-radius: 8px;
      padding: 1em;
      margin-bottom: 0.8em;
      box-shadow: 0 0 4px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: background 0.3s;
    }
    .program-card:hover {
      background: #f0f4ff;
    }
    body.dark-mode .program-card {
      background: #1f1f1f;
      box-shadow: none;
    }
    .program-card:hover {
      background: #f0f4ff;
    }
    body.dark-mode .program-card:hover {
      background: #2f2f2f;
    }

    .program-title {
      font-weight: bold;
      margin-bottom: 0.5em;
    }
    .program-exercises {
      font-size: 0.9rem;
      color: #555;
    }
    body.dark-mode .program-exercises {
      color: #bbb;
    }

    /* LISTE D'EXERCICES DÉTAILLÉS (DRAG & DROP) */
    .exercise-list {
      list-style: none;
      margin: 1em 0;
      padding: 0;
    }
    .exercise-item {
      background: #fff;
      border-radius: 6px;
      padding: 0.8em;
      margin-bottom: 0.5em;
      box-shadow: 0 0 4px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.3s;
    }
    .exercise-item.done {
      background-color: #e4fce3;
    }
    body.dark-mode .exercise-item {
      background: #1f1f1f;
    }
    body.dark-mode .exercise-item.done {
      background-color: #226633; /* Un vert sombre */
    }

    .exercise-item.drag-over {
      outline: 2px dashed #3B82F6;
      outline-offset: -4px;
    }

    .exercise-name {
      font-weight: 500;
    }
    .exercise-details {
      font-size: 0.85rem;
      color: #777;
      margin-top: 0.3em;
    }
    body.dark-mode .exercise-details {
      color: #999;
    }

    /* BOUTON “DONE” */
    .done-btn {
      background: #34D399; /* vert menthe / success */
      color: #fff;
      border: none;
      padding: 0.6em 0.8em;
      border-radius: 4px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: opacity 0.3s;
    }
    .done-btn:hover {
      opacity: 0.9;
    }

    /* SECTION DE RÉCOMPENSES (PROGRESSION) */
    .rewards-box {
      background: #fff;
      border-radius: 8px;
      text-align: center;
      padding: 1em;
      box-shadow: 0 0 4px rgba(0,0,0,0.1);
      margin-bottom: 1em;
    }
    body.dark-mode .rewards-box {
      background: #1f1f1f;
      box-shadow: none;
    }

    .reward-message {
      font-size: 1rem;
      margin-top: 1em;
      color: #3B82F6;
      font-weight: bold;
    }
    body.dark-mode .reward-message {
      color: #7C3AED;
    }

    /* Carte de résumé hebdo */
    .week-summary {
      background-color: #fff;
      border-radius: 8px;
      padding: 1em;
      box-shadow: 0 0 4px rgba(0,0,0,0.1);
      margin-bottom: 1em;
      text-align: center;
    }
    body.dark-mode .week-summary {
      background-color: #1f1f1f;
      box-shadow: none;
    }
    .week-summary h3 {
      margin-bottom: 0.5em;
      color: #3B82F6;
      font-size: 1rem;
    }
    body.dark-mode .week-summary h3 {
      color: #7C3AED;
    }

    .week-days {
      display: flex;
      justify-content: space-between;
      margin-top: 1em;
    }
    .day-circle {
      width: 40px; 
      height: 40px; 
      border-radius: 50%;
      background-color: #e2e2e2;
      display: flex; 
      align-items: center; 
      justify-content: center;
      flex-direction: column;
      font-size: 0.75rem;
      color: #333;
      transition: background-color 0.3s;
    }
    .day-circle.done {
      background-color: #34D399; /* vert si séance effectuée */
      color: #fff;
    }
    body.dark-mode .day-circle {
      background-color: #333;
      color: #e0e0e0;
    }
    body.dark-mode .day-circle.done {
      background-color: #3fbf8b; /* Un vert un peu plus “sombre” */
    }

    /* CONFETTI CANVAS */
    #confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }
  </style>
</head>
<body>

  <!-- CANVAS POUR CONFETTI -->
  <canvas id="confetti-canvas"></canvas>

  <!-- BARRE DE NAVIGATION SIMPLIFIÉE -->
  <nav class="nav-bar">
    <div>
      <button id="navHome" class="active">Accueil</button>
      <button id="navProgram">Programme</button>
      <button id="navProgress">Progression</button>
    </div>
    <button id="toggleDarkModeBtn">Mode Sombre</button>
  </nav>

  <!-- SECTION ACCUEIL -->
  <section id="home" class="active">
    <header>
      <h1>Bienvenue sur Mon MVP Sport</h1>
    </header>
    <p>Salut Sportif ! Prêt pour ta séance du jour ?</p>
    <!-- TINY HABIT / MICRO-CHALLENGE -->
    <p><em>Micro-challenge : Fais 5 squats rapides pour t’échauffer !</em></p>
    <button class="btn" id="btnStart">Lancer ma séance</button>
  </section>

  <!-- SECTION PROGRAMME (LISTE DES SÉANCES) -->
  <section id="program">
    <h2>Mon Programme Hebdo</h2>

    <!-- Séance 1 : Jambes -->
    <div class="program-card" onclick="window.openSessionDetails('legs')">
      <div class="program-title">Séance 1 : Jambes</div>
      <div class="program-exercises">Squats, Fentes, Presse à cuisses, Soulevé de terre, Mollets</div>
    </div>

    <!-- Séance 2 : Dos & Biceps -->
    <div class="program-card" onclick="window.openSessionDetails('backBiceps')">
      <div class="program-title">Séance 2 : Dos & Biceps</div>
      <div class="program-exercises">Tractions, Rowing, Tirage, Curl biceps, Curl marteau</div>
    </div>

    <!-- Séance 3 : Épaules & Triceps -->
    <div class="program-card" onclick="window.openSessionDetails('shouldersTriceps')">
      <div class="program-title">Séance 3 : Épaules & Triceps</div>
      <div class="program-exercises">Développé militaire, Élévations latérales, Oiseau, Développé couché serré, Extension triceps</div>
    </div>

    <button class="btn" id="btnReturnHome">Retour Accueil</button>
  </section>

  <!-- SECTION DÉTAIL D'UNE SÉANCE -->
  <section id="session-details">
    <h2 id="sessionTitle">Détails de la Séance</h2>
    <ul class="exercise-list" id="exerciseList">
      <!-- Les exercices seront injectés dynamiquement via JavaScript -->
      <!-- DRAG & DROP => On gérera le dragstart, dragover, drop, etc. en JS -->
    </ul>
    <button class="btn" id="finishSessionBtn" style="display:none;">Terminer la séance</button>
    <button class="btn" id="btnReturnProgram">Retour Programme</button>
  </section>

  <!-- SECTION RÉCOMPENSE (FIN DE SÉANCE) & PROGRESSION -->
  <section id="rewards">
    <!-- Carte de récompense -->
    <div class="rewards-box">
      <h2>Félicitations !</h2>
      <p>Tu as terminé ta séance avec succès.</p>
      <p class="reward-message" id="rewardPoints"></p>
      <p id="streakMessage"></p>
      <button class="btn" id="btnToProgram">Voir le programme</button>
      <button class="btn" id="btnToHome">Accueil</button>
    </div>

    <!-- Carte de résumé Hebdomadaire -->
    <div class="week-summary" id="weekSummaryCard">
      <h3>Résumé de la semaine</h3>
      <p>Visualise tes séances sur les 7 derniers jours.</p>
      <div class="week-days" id="weekDaysContainer">
        <!-- Cercles dynamiques injectés par JavaScript -->
      </div>
    </div>
  </section>

  <!-- On charge la bibliothèque Confetti en dernier pour éviter tout conflit d'exécution -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>

  <!-- SCRIPT INLINE POUR LA NAVIGATION, LA LOGIQUE MVP, DRAG & DROP, DARK MODE -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // --- Initialisation du Confetti ---
      const confettiCanvas = document.getElementById('confetti-canvas');
      // On crée une instance nommée "myConfetti" pour éviter tout conflit avec la fonction globale "confetti".
      const myConfetti = confetti.create(confettiCanvas, {
        resize: true,
        useWorker: true
      });

      // --- DARK MODE ---
      const toggleDarkModeBtn = document.getElementById('toggleDarkModeBtn');
      toggleDarkModeBtn.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        if (document.body.classList.contains('dark-mode')) {
          toggleDarkModeBtn.textContent = "Mode Clair";
        } else {
          toggleDarkModeBtn.textContent = "Mode Sombre";
        }
      });

      // --- Données de base du programme : on peut les stocker en local pour un MVP ---
      const programData = {
        legs: {
          title: "Séance 1 : Jambes",
          exercises: [
            { name: "Squats", sets: "4 séries de 8-12 répétitions" },
            { name: "Fentes", sets: "3 séries de 10 répétitions par jambe" },
            { name: "Presse à cuisses", sets: "3 séries de 10-12 répétitions" },
            { name: "Soulevé de terre jambes tendues", sets: "3 séries de 12 répétitions" },
            { name: "Mollets", sets: "4 séries de 15-20 répétitions" }
          ]
        },
        backBiceps: {
          title: "Séance 2 : Dos & Biceps",
          exercises: [
            { name: "Tractions (ou tirage poitrine)", sets: "4 séries de 8-12 répétitions" },
            { name: "Rowing barre", sets: "4 séries de 10-12 répétitions" },
            { name: "Tirage horizontal", sets: "3 séries de 12 répétitions" },
            { name: "Curl biceps", sets: "3 séries de 10-12 répétitions" },
            { name: "Curl marteau", sets: "3 séries de 12 répétitions" }
          ]
        },
        shouldersTriceps: {
          title: "Séance 3 : Épaules & Triceps",
          exercises: [
            { name: "Développé militaire", sets: "4 séries de 8-12 répétitions" },
            { name: "Élévations latérales", sets: "3 séries de 12-15 répétitions" },
            { name: "Oiseau (épaules arrière)", sets: "3 séries de 12-15 répétitions" },
            { name: "Développé couché prise serrée", sets: "4 séries de 8-12 répétitions" },
            { name: "Extension triceps", sets: "3 séries de 12 répétitions" }
          ]
        }
      };

      // --- STATE pour suivi MVP ---
      let totalSessionsCompleted = parseInt(localStorage.getItem('totalSessionsCompleted') || '0');
      let currentStreak = parseInt(localStorage.getItem('currentStreak') || '0');
      let lastCompletionDate = localStorage.getItem('lastCompletionDate') || null;
      let completedDates = JSON.parse(localStorage.getItem('completedDates') || '[]');

      // --- FONCTIONS DE NAVIGATION ---
      function showSection(sectionId) {
        // Masquer toutes les sections
        document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
        // Afficher la section ciblée
        document.getElementById(sectionId).classList.add('active');

        // Gérer l'état des boutons de nav
        document.getElementById('navHome').classList.remove('active');
        document.getElementById('navProgram').classList.remove('active');
        document.getElementById('navProgress').classList.remove('active');

        if (sectionId === 'home') {
          document.getElementById('navHome').classList.add('active');
        }
        if (sectionId === 'program') {
          document.getElementById('navProgram').classList.add('active');
        }
        if (sectionId === 'rewards') {
          document.getElementById('navProgress').classList.add('active');
          updateWeekSummary();
        }
      }

      function goHome() {
        showSection('home');
      }
      function goProgram() {
        showSection('program');
      }
      function goRewards() {
        showSection('rewards');
      }

      // --- OUVRIR LES DÉTAILS D'UNE SÉANCE ---
      window.openSessionDetails = function(sessionKey) {
        const session = programData[sessionKey];
        if (!session) return;

        // Mettre à jour le titre
        document.getElementById('sessionTitle').textContent = session.title;

        // Nettoyer la liste d'exos
        const exerciseList = document.getElementById('exerciseList');
        exerciseList.innerHTML = '';

        // Peupler la liste AVEC DRAG & DROP
        session.exercises.forEach((ex) => {
          const li = document.createElement('li');
          li.className = 'exercise-item';
          li.draggable = true; // Rendre la carte draggable
          li.innerHTML = `
            <div>
              <div class="exercise-name">${ex.name}</div>
              <div class="exercise-details">${ex.sets}</div>
            </div>
            <button class="done-btn" data-clicks="0">0</button>
          `;

          // Ajout listener sur le bouton "series"
          const btn = li.querySelector('.done-btn');
          btn.addEventListener('click', () => handleExerciseClick(btn));

          // Gérer DRAG & DROP
          li.addEventListener('dragstart', dragStart);
          li.addEventListener('dragover', dragOver);
          li.addEventListener('drop', dropItem);
          li.addEventListener('dragend', dragEnd);
          
          exerciseList.appendChild(li);
        });

        // Remettre le bouton "Terminer la séance" à l'état initial (caché)
        document.getElementById('finishSessionBtn').style.display = 'none';
        showSection('session-details');
      };

      // --- LOGIQUE DE CLIQUAGE SUR LE BOUTON D'UN EXERCICE (4 séries) ---
      function handleExerciseClick(btn) {
        let currentClicks = parseInt(btn.getAttribute('data-clicks'));
        currentClicks++;

        if (currentClicks < 4) {
          // Mettre à jour le texte + attribut
          btn.textContent = currentClicks.toString();
          btn.setAttribute('data-clicks', currentClicks);
        } else {
          // 4ᵉ clic => Fait, exercise "done"
          btn.textContent = "Fait";
          btn.disabled = true;
          btn.parentElement.classList.add('done');

          btn.setAttribute('data-clicks', "4");

          // Lancer la confetti
          myConfetti({
            particleCount: 30,
            spread: 60,
            origin: { y: 0.6 }
          });
        }

        checkAllExercisesDone();
      }

      // --- CHECK SI TOUS LES EXERCICES SONT FAITS ---
      function checkAllExercisesDone() {
        const allExercises = document.querySelectorAll('#exerciseList .exercise-item');
        const allDone = [...allExercises].every(item => {
          const b = item.querySelector('.done-btn');
          return (b.getAttribute('data-clicks') === "4");
        });

        if (allDone) {
          document.getElementById('finishSessionBtn').style.display = 'block';
        }
      }

      // --- FIN DE SÉANCE ---
      document.getElementById('finishSessionBtn').addEventListener('click', () => {
        totalSessionsCompleted++;
        localStorage.setItem('totalSessionsCompleted', totalSessionsCompleted);

        const today = new Date().toLocaleDateString('fr-CA');
        if (lastCompletionDate === today) {
          // déjà fait aujourd'hui
        } else {
          if (lastCompletionDate) {
            const diff = new Date(today) - new Date(lastCompletionDate);
            if (diff === 86400000) {
              currentStreak++;
            } else {
              currentStreak = 1;
            }
          } else {
            currentStreak = 1;
          }
        }
        localStorage.setItem('currentStreak', currentStreak);
        localStorage.setItem('lastCompletionDate', today);
        lastCompletionDate = today;

        if (!completedDates.includes(today)) {
          completedDates.push(today);
          localStorage.setItem('completedDates', JSON.stringify(completedDates));
        }

        document.getElementById('rewardPoints').textContent = 
          `Tu as complété ${totalSessionsCompleted} séance(s) au total !`;
        document.getElementById('streakMessage').textContent =
          `Streak actuel : ${currentStreak} jour(s) consécutif(s) !`;

        myConfetti({
          particleCount: 100,
          spread: 70,
          origin: { y: 0.6 }
        });

        showSection('rewards');
      });

      // --- AFFICHER RÉSUMÉ HEBDO ---
      function updateWeekSummary() {
        const container = document.getElementById('weekDaysContainer');
        container.innerHTML = '';

        const now = new Date();
        for (let i = 6; i >= 0; i--) {
          let checkDate = new Date(now);
          checkDate.setDate(checkDate.getDate() - i);
          const dayStr = checkDate.toISOString().split('T')[0];

          const options = { weekday: 'short' };
          const dayLabel = checkDate.toLocaleDateString('fr-FR', options);

          const dayDiv = document.createElement('div');
          dayDiv.className = 'day-circle';
          if (completedDates.includes(dayStr)) {
            dayDiv.classList.add('done');
          }
          dayDiv.innerHTML = `<span class="day-label">${dayLabel}</span>`;

          container.appendChild(dayDiv);
        }
      }

      // --- DRAG & DROP LOGIC ---
      let draggedItem = null;

      function dragStart(e) {
        draggedItem = this;
        e.dataTransfer.effectAllowed = "move";
      }
      function dragOver(e) {
        e.preventDefault(); // important pour autoriser le drop
        this.classList.add('drag-over');
      }
      function dropItem(e) {
        e.preventDefault();
        this.classList.remove('drag-over');

        if (draggedItem !== this) {
          const exerciseList = document.getElementById('exerciseList');
          // Positionner draggedItem avant (ou après) this
          const items = [...exerciseList.children];
          const draggedIndex = items.indexOf(draggedItem);
          const droppedIndex = items.indexOf(this);

          if (draggedIndex < droppedIndex) {
            // On le place après
            exerciseList.insertBefore(draggedItem, this.nextSibling);
          } else {
            // On le place avant
            exerciseList.insertBefore(draggedItem, this);
          }
        }
      }
      function dragEnd() {
        document.querySelectorAll('.exercise-item').forEach(item => {
          item.classList.remove('drag-over');
        });
        draggedItem = null;
      }

      // --- Écouteurs de navigation ---
      document.getElementById('navHome').addEventListener('click', goHome);
      document.getElementById('navProgram').addEventListener('click', goProgram);
      document.getElementById('navProgress').addEventListener('click', goRewards);

      document.getElementById('btnReturnHome').addEventListener('click', goHome);
      document.getElementById('btnReturnProgram').addEventListener('click', goProgram);
      document.getElementById('btnToProgram').addEventListener('click', goProgram);
      document.getElementById('btnToHome').addEventListener('click', goHome);

      document.getElementById('btnStart').addEventListener('click', goProgram);

      // Par défaut, on affiche déjà la Home
    });
  </script>
</body>
</html>
